<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>IC Database Assistant</title>
    <link rel="stylesheet" href="/static/css/style.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
</head>

<body>
    <!-- Cute Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="robot-carousel">
                <img src="/static/img/loading/robot_read.png" class="active" alt="Reading Robot">
                <img src="/static/img/loading/robot_work.png" alt="Working Robot">
                <img src="/static/img/loading/robot_idea.png" alt="Happy Robot">
            </div>
            <h2 id="loadingStep">正在唤醒 AI 助手...</h2>
            <div class="loading-progress-bar">
                <div class="loading-progress-fill" id="loadingFill" style="width: 0%"></div>
            </div>
        </div>
    </div>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <span class="logo-icon">🧠</span>
                <h1>IC 知识库</h1>
            </div>

            <div class="nav-menu">
                <button class="nav-item active" onclick="switchTab('chat')">
                    <i class="fa-regular fa-comments"></i> 对话
                </button>
                <button class="nav-item" onclick="switchTab('docs')">
                    <i class="fa-regular fa-folder-open"></i> 知识库
                </button>
            </div>

            <div class="upload-section">
                <!-- <h3>上传文档</h3> -->
                <div class="drop-zone" id="dropZone">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                    <p>点击或拖拽上传 PDF</p>
                    <span class="sub-text">支持多文件上传</span>
                    <input type="file" id="fileInput" accept=".pdf" multiple hidden>
                </div>
            </div>

            <!-- Task Progress List -->
            <div id="taskList" class="task-list">
                <!-- Tasks will be injected here -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- View: Chat -->
            <div id="view-chat" class="view-section active">
                <header class="top-bar">
                    <div class="status-indicator">
                        <span class="dot"></span>
                        <span id="systemStatus">系统在线</span>
                    </div>
                </header>

                <div id="chatContainer" class="chat-container">
                    <div class="welcome-message">
                        <h2>你好！我是你的 IC 设计助手。</h2>
                        <p>你可以上传 PDF 文档，然后问我关于工艺参数、设计规范的问题。</p>
                    </div>
                    <!-- Messages will be injected here -->
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <textarea id="chatInput" placeholder="输入你的问题..." rows="1"></textarea>
                        <button id="sendBtn" class="btn-send">
                            <i class="fa-regular fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- View: Documents -->
            <div id="view-docs" class="view-section hidden">
                <header class="top-bar">
                    <h2>知识库管理</h2>
                    <button class="btn-refresh" onclick="loadFileList()">
                        <i class="fa-solid fa-rotate-right"></i> 刷新
                    </button>
                </header>

                <div class="docs-container">
                    <table class="docs-table">
                        <thead>
                            <tr>
                                <th>文件名</th>
                                <th>上传时间</th>
                                <th>大小</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="file-list-body">
                            <!-- Files will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- Preview Modal -->
        <div id="previewModal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <div id="previewContent"></div>
            </div>
        </div>
    </div>
    <script src="/static/js/main.js?v=2"></script>
</body>

</html>